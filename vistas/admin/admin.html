<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Hidrogest</title>
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/favicon/favicon-16x16.png"
    />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="../dashboard.css" />
    <link rel="stylesheet" href="admin.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="logo">
          <img src="../LOGO.png" alt="Logo" />
          <span class="logo-text">AdminPanel</span>
        </div>
      </div>
      <div class="header-center">
        <div class="search-bar">
          <input type="text" placeholder="Buscar..." />
          <button class="search-btn">🔍</button>
        </div>
      </div>
      <div class="header-right">
        <div class="user-menu">
          <button class="user-btn">
            <div class="user-avatar">A</div>
            <div class="user-info">
              <span class="user-name">Admin</span>
              <span class="user-type">Superuser</span>
            </div>
          </button>
        </div>
      </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <div class="nav-section">
          <h4 class="nav-title">Principal</h4>
          <ul class="nav-list">
            <li class="nav-item active">
              <a class="nav-link" href="admin.html">📊 Dashboard</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="usuarios.html">👥 Usuarios</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="reportes.html">📦 Reportes</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="facturacion.html">💳 Facturación</a>
            </li>
          </ul>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Mapa -->
      <div class="widget">
        <div class="widget-header">
          <h3>Mapa de Operaciones</h3>
        </div>
        <div
          id="map"
          style="height: 300px; border-radius: 12px; margin-bottom: 20px"
        ></div>
      </div>

      <!-- Grid de widgets -->
      <div class="widgets-grid">
        <div class="widget">
          <div class="widget-header">
            <h3>Usuarios activos</h3>
          </div>
          <p>Actualmente: <strong>154</strong> usuarios online</p>
        </div>
        <div class="widget">
          <div class="widget-header-reportes">
            <h3>Reportes recientes</h3>
          </div>
          <ul>
            <li>🔴 Problemas graves de agua</li>
            <li>🟡 Mantenimiento en proceso</li>
            <li>🟢 Servicio normal</li>
            <li>🔵 Zona en observación</li>
            <li>🟣 Reporte técnico en revisión</li>
          </ul>
        </div>
        <div class="widget">
          <div class="widget-header">
            <h3>Acciones rápidas</h3>
          </div>
          <div class="actions-grid">
            <button class="action-btn primary">
              <span class="action-icon">➕</span>
              <span class="action-text">Nuevo Reporte</span>
            </button>
            <button class="action-btn secondary">
              <span class="action-icon">👥</span>
              <span class="action-text">Gestionar Usuarios</span>
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Modal: Nuevo Reporte -->
    <div id="modal-reporte" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Nuevo Reporte</h3>
          <button class="modal-close" data-close="modal-reporte">✖</button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="titulo">Título</label>
              <input
                type="text"
                id="titulo"
                placeholder="Ej: Corte en zona norte"
              />
            </div>
            <div class="form-group">
              <label for="descripcion">Descripción</label>
              <textarea id="descripcion" placeholder="Detalles..."></textarea>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn-primary">Guardar</button>
              <button
                type="button"
                class="btn-secondary"
                data-close="modal-reporte"
              >
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Notificación (Toast) -->
    <div id="toast" class="toast">Reporte aprobado ✅</div>

    <!-- Modal: Gestionar Usuarios -->
    <div id="modal-usuarios" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Gestionar Usuarios</h3>
          <button class="modal-close" data-close="modal-usuarios">✖</button>
        </div>
        <div class="modal-body">
          <table class="users-table">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Correo</th>
                <th>Rol</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Juan Pérez</td>
                <td>juan@example.com</td>
                <td>Administrador</td>
                <td>
                  <button class="btn-secondary btn-sm">✏ Editar</button>
                  <button class="btn-danger btn-sm">🗑 Eliminar</button>
                </td>
              </tr>
              <tr>
                <td>María Gómez</td>
                <td>maria@example.com</td>
                <td>Usuario</td>
                <td>
                  <button class="btn-secondary btn-sm">✏ Editar</button>
                  <button class="btn-danger btn-sm">🗑 Eliminar</button>
                </td>
              </tr>
              <tr>
                <td>Carlos López</td>
                <td>carlos@example.com</td>
                <td>Supervisor</td>
                <td>
                  <button class="btn-secondary btn-sm">✏ Editar</button>
                  <button class="btn-danger btn-sm">🗑 Eliminar</button>
                </td>
              </tr>
            </tbody>
          </table>

          <div class="form-actions">
            <button class="btn-secondary" data-close="modal-usuarios">
              Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Confirmar Eliminación -->
    <div id="modal-confirmar" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Confirmar eliminación</h3>
          <button class="modal-close" data-close="modal-confirmar">✖</button>
        </div>
        <div class="modal-body">
          <p>⚠ ¿Seguro que deseas eliminar este usuario?</p>
          <div class="form-actions">
            <button id="confirmarEliminar" class="btn-danger">Eliminar</button>
            <button class="btn-secondary" data-close="modal-confirmar">
              Cancelar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Nueva Zona -->
    <div id="modal-zona" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Agregar Nueva Zona</h3>
          <button class="modal-close" data-close="modal-zona">✖</button>
        </div>
        <div class="modal-body">
          <form id="formZona">
            <input type="hidden" id="zonaLat" />
            <input type="hidden" id="zonaLng" />

            <div class="form-group">
              <label for="nombreZona">Nombre de la zona</label>
              <input
                type="text"
                id="nombreZona"
                placeholder="Ej: Zona Norte"
                required
              />
            </div>

            <div class="form-group">
              <label for="estadoZona">Estado</label>
              <select id="estadoZona" required>
                <option value="rojo">🔴 Problemas graves de agua</option>
                <option value="amarillo">🟡 Mantenimiento en proceso</option>
                <option value="verde">🟢 Servicio normal</option>
                <option value="azul">🔵 Zona en observación</option>
                <option value="morado">🟣 Reporte técnico en revisión</option>
              </select>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn-primary">Guardar</button>
              <button
                type="button"
                class="btn-secondary"
                data-close="modal-zona"
              >
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Script Mapa -->
    <script>
  const lat = 9.91152;
  const lon = -67.35377;

  const map = L.map("map").setView([lat, lon], 13);

  // Capa base
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "&copy; OpenStreetMap contributors",
  }).addTo(map);

  // Lista de zonas circulares iniciales
  let zonas = [
    {
      nombre: "Zona Norte",
      coords: [9.915, -67.355],
      color: "red",
      mensaje: "🔴 Problemas graves de agua",
    },
    {
      nombre: "Zona Centro",
      coords: [9.905, -67.36],
      color: "orange",
      mensaje: "🟡 Mantenimiento en proceso",
    },
    {
      nombre: "Zona Sur",
      coords: [9.92, -67.345],
      color: "green",
      mensaje: "🟢 Servicio normal",
    },
    {
      nombre: "Zona Este",
      coords: [9.918, -67.365],
      color: "blue",
      mensaje: "🔵 Zona en observación",
    },
    {
      nombre: "Zona Oeste",
      coords: [9.912, -67.338],
      color: "purple",
      mensaje: "🟣 Reporte técnico en revisión",
    },
  ];

  // Funciones de interactividad
  function highlight(e) {
    const layer = e.target;
    layer.setStyle({
      weight: 3,
      fillOpacity: 0.6,
    });
  }

  function resetHighlight(e) {
    const layer = e.target;
    layer.setStyle({
      weight: 1,
      fillOpacity: 0.3,
    });
  }

  function zoomToFeature(e) {
    map.fitBounds(e.target.getBounds());
  }

  // Función para crear círculo con eventos
  function crearZona(z) {
    const circle = L.circle(z.coords, {
      color: z.color,
      fillColor: z.color,
      fillOpacity: 0.3,
      radius: 600, // metros
    })
      .addTo(map)
      .bindPopup(`<b>${z.nombre}</b><br>${z.mensaje}`);

    // Eventos
    circle.on({
      mouseover: highlight,
      mouseout: resetHighlight,
      click: zoomToFeature,
    });
  }

  // Render inicial de zonas
  zonas.forEach((z) => crearZona(z));

  // ========= INTERACTIVIDAD CON MODAL =========
  const modalZona = document.getElementById("modal-zona");
  const formZona = document.getElementById("formZona");

  // Abrir modal al hacer click en el mapa
  map.on("click", function (e) {
    document.getElementById("zonaLat").value = e.latlng.lat;
    document.getElementById("zonaLng").value = e.latlng.lng;
    modalZona.classList.add("show");
  });

  // Guardar nueva zona desde el modal
  formZona.addEventListener("submit", (e) => {
    e.preventDefault();

    const lat = parseFloat(document.getElementById("zonaLat").value);
    const lng = parseFloat(document.getElementById("zonaLng").value);
    const nombre = document.getElementById("nombreZona").value;
    const estado = document.getElementById("estadoZona").value;

    let color = "blue";
    let mensaje = "🔵 Zona en observación";

    if (estado === "rojo") {
      color = "red";
      mensaje = "🔴 Problemas graves de agua";
    } else if (estado === "amarillo") {
      color = "orange";
      mensaje = "🟡 Mantenimiento en proceso";
    } else if (estado === "verde") {
      color = "green";
      mensaje = "🟢 Servicio normal";
    } else if (estado === "morado") {
      color = "purple";
      mensaje = "🟣 Reporte técnico en revisión";
    }

    const nuevaZona = { nombre, coords: [lat, lng], color, mensaje };

    zonas.push(nuevaZona);
    crearZona(nuevaZona);

    modalZona.classList.remove("show"); // cerrar modal
    formZona.reset();
  });

  // Cerrar modal
  document.querySelectorAll("[data-close]").forEach((btn) => {
    btn.addEventListener("click", () => {
      document.getElementById(btn.getAttribute("data-close")).classList.remove("show");
    });
  });
</script>

    <script>
      // Modal de Nuevo Reporte
      const modalReporte = document.getElementById("modal-reporte");
      const toast = document.getElementById("toast");

      // Interceptar el submit del formulario
      modalReporte.querySelector("form").addEventListener("submit", (e) => {
        e.preventDefault(); // Evita recargar
        modalReporte.classList.remove("show"); // Cerrar modal

        // Mostrar toast
        toast.classList.add("show");

        // Ocultar automáticamente después de 3s
        setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      });
    </script>
    <script>
      // Abrir modal según botón
      document
        .querySelector(".action-btn.primary")
        .addEventListener("click", () => {
          document.getElementById("modal-reporte").classList.add("show");
        });

      document
        .querySelector(".action-btn.secondary")
        .addEventListener("click", () => {
          document.getElementById("modal-usuarios").classList.add("show");
        });

      document
        .querySelector(".action-btn.success")
        .addEventListener("click", () => {
          document.getElementById("modal-aprobar").classList.add("show");
        });

      // Cerrar modal
      document.querySelectorAll("[data-close]").forEach((el) => {
        el.addEventListener("click", () => {
          const id = el.getAttribute("data-close");
          document.getElementById(id).classList.remove("show");
        });
      });

      // Cerrar clickeando fuera
      window.addEventListener("click", (e) => {
        if (e.target.classList.contains("modal")) {
          e.target.classList.remove("show");
        }
      });
    </script>
    <script>
      let filaAEliminar = null; // Guardamos la fila seleccionada

      // Cuando se pulsa en "Eliminar" en la tabla
      document.querySelectorAll(".btn-danger.btn-sm").forEach((btn) => {
        btn.addEventListener("click", () => {
          filaAEliminar = btn.closest("tr"); // Guardamos la fila
          document.getElementById("modal-confirmar").classList.add("show");
        });
      });

      // Confirmar eliminación
      document
        .getElementById("confirmarEliminar")
        .addEventListener("click", () => {
          if (filaAEliminar) {
            filaAEliminar.remove(); // Elimina la fila
            filaAEliminar = null;
          }
          document.getElementById("modal-confirmar").classList.remove("show");
        });

      // Cerrar modal (X o botones con data-close)
      document.querySelectorAll("[data-close]").forEach((btn) => {
        btn.addEventListener("click", () => {
          const target = btn.getAttribute("data-close");
          document.getElementById(target).classList.remove("show");
        });
      });

      // Cerrar clickeando fuera del contenido
      window.addEventListener("click", (e) => {
        if (e.target.classList.contains("modal")) {
          e.target.classList.remove("show");
        }
      });

      // Editar usuario (ejemplo simple con alert)
      document.querySelectorAll(".btn-secondary.btn-sm").forEach((btn) => {
        btn.addEventListener("click", () => {
          window.location.href = "usuarios.html";
        });
      });
    </script>
  </body>
</html>
