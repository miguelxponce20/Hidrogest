<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendario - Admin Hidrogest</title>
     <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../favicon/favicon-16x16.png"
    />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="../colores.css" />
    <link rel="stylesheet" href="admin.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Abrir menÃº">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div class="logo">
          <img src="../LOGO.png" alt="Logo" />
          <span class="logo-text">AdminPanel</span>
        </div>
      </div>
      <div class="header-center">
        <h2>GestiÃ³n de Calendario</h2>
      </div>
      <div class="header-right">
        <div class="user-menu">
          <button class="user-btn">
            <div class="user-avatar">A</div>
            <div class="user-info">
              <span class="user-name">Admin</span>
              <span class="user-type">Superuser</span>
            </div>
          </button>
        </div>
      </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <nav class="sidebar-nav">
        <div class="nav-section">
          <h4 class="nav-title">Principal</h4>
          <ul class="nav-list">
            <li class="nav-item"><a class="nav-link" href="admin.html">ðŸ“Š Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="usuarios.html">ðŸ‘¥ Usuarios</a></li>
            <li class="nav-item"><a class="nav-link" href="reportes.html">ðŸ“¦ Reportes</a></li>
            <li class="nav-item"><a class="nav-link" href="facturacion.html">ðŸ’³ FacturaciÃ³n</a></li>
            <li class="nav-item active"><a class="nav-link" href="#">ðŸ“… Calendario</a></li>
          </ul>
        </div>
      </nav>
    </aside>

    <!-- Overlay para mÃ³viles -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Content -->
    <main class="main-content">
      <div class="calendar-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <button id="prevMonth" class="btn-secondary btn-sm">â—€</button>
        <h2 id="currentMonth"></h2>
        <button id="nextMonth" class="btn-secondary btn-sm">â–¶</button>
        <button id="btnAddEvent" class="btn-primary btn-sm">âž• Nueva Incidencia</button>
      </div>

             <div id="calendarGrid" style="display:grid; grid-template-columns:repeat(7,1fr); gap:6px; margin-top: 20px;"></div>
    </main>

    <!-- Modal: Eventos del DÃ­a -->
    <div id="dayModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="dayModalTitle"></h3>
          <button id="dayModalClose" class="modal-close">âœ–</button>
        </div>
        <div id="dayModalBody" class="modal-body"></div>
      </div>
      <div class="modal-overlay"></div>
    </div>

    <!-- Modal: Nueva Incidencia -->
    <div id="modal-evento" class="modal">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>Agregar Incidencia</h3>
          <button class="modal-close" data-close="modal-evento">âœ–</button>
        </div>
        <div class="modal-body">
          <form id="formEvento">
            <div class="form-group">
              <label for="fechaEvento">Fecha</label>
              <input type="date" id="fechaEvento" required />
            </div>
            <div class="form-group">
              <label for="tipoEvento">Tipo</label>
              <select id="tipoEvento" required>
                <option value="maintenance">ðŸ”§ Mantenimiento</option>
                <option value="cut">â›” Corte</option>
                <option value="supervision">ðŸ‘€ SupervisiÃ³n</option>
              </select>
            </div>
            <div class="form-group">
              <label for="tituloEvento">TÃ­tulo</label>
              <input type="text" id="tituloEvento" placeholder="Ej: Corte sector norte" required />
            </div>
            <div class="form-actions">
              <button type="submit" class="btn-primary">Guardar</button>
              <button type="button" class="btn-secondary" data-close="modal-evento">Cancelar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      const events = {
        "2025-09-05": [{ type: "maintenance", title: "Mantenimiento estaciÃ³n norte" }],
        "2025-09-10": [{ type: "cut", title: "Corte sector centro" }],
        "2025-09-15": [{ type: "supervision", title: "SupervisiÃ³n general" }],
      };

      const calendarGrid = document.getElementById("calendarGrid");
      const currentMonthEl = document.getElementById("currentMonth");
      let currentDate = new Date();

      function getMondayBasedDay(jsDay) {
        return (jsDay + 6) % 7;
      }

      function renderCalendar() {
        calendarGrid.innerHTML = "";
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        currentMonthEl.textContent = currentDate.toLocaleDateString("es-ES", {
          month: "long",
          year: "numeric",
        });

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startDay = getMondayBasedDay(firstDay.getDay());
        const daysInMonth = lastDay.getDate();

        for (let i = 0; i < startDay; i++) {
          const el = document.createElement("div");
          el.classList.add("calendar-day", "empty");
          calendarGrid.appendChild(el);
        }

        for (let d = 1; d <= daysInMonth; d++) {
          const dateStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(d).padStart(2, "0")}`;
          const el = document.createElement("div");
          el.classList.add("calendar-day");
          el.textContent = d;

                     if (events[dateStr]) {
             events[dateStr].forEach((e) => el.classList.add(e.type));
             el.onclick = () => showDayEvents(dateStr);
           }

           // Hacer que todos los dÃ­as sean clickeables para mostrar eventos
           el.onclick = () => showDayEvents(dateStr);

          calendarGrid.appendChild(el);
        }
      }

    

      document.getElementById("prevMonth").onclick = () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
      };
      document.getElementById("nextMonth").onclick = () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
      };

      function capitalize(s) {
        return s.charAt(0).toUpperCase() + s.slice(1);
      }

      const modalEvento = document.getElementById("modal-evento");
      document.getElementById("btnAddEvent").onclick = () => {
        modalEvento.classList.add("show");
      };

      document.querySelectorAll("[data-close]").forEach((btn) => {
        btn.addEventListener("click", () => {
          document.getElementById(btn.getAttribute("data-close")).classList.remove("show");
        });
      });

      document.getElementById("formEvento").addEventListener("submit", (e) => {
        e.preventDefault();
        const fecha = document.getElementById("fechaEvento").value;
        const tipo = document.getElementById("tipoEvento").value;
        const titulo = document.getElementById("tituloEvento").value;

        if (!events[fecha]) events[fecha] = [];
        events[fecha].push({ type: tipo, title: titulo });

        modalEvento.classList.remove("show");
        e.target.reset();
        renderCalendar();
      });

             renderCalendar();

       // FunciÃ³n para mostrar eventos del dÃ­a
       function showDayEvents(dateStr) {
         const dayEvents = events[dateStr] || [];
         const dayModal = document.getElementById('dayModal');
         const dayModalTitle = document.getElementById('dayModalTitle');
         const dayModalBody = document.getElementById('dayModalBody');
         
         const date = new Date(dateStr);
         const formattedDate = date.toLocaleDateString('es-ES', {
           weekday: 'long',
           year: 'numeric',
           month: 'long',
           day: 'numeric'
         });
         
         dayModalTitle.textContent = `Eventos del ${formattedDate}`;
         
         if (dayEvents.length === 0) {
           dayModalBody.innerHTML = '<p>No hay eventos programados para este dÃ­a.</p>';
         } else {
           let eventsHTML = '<ul style="list-style: none; padding: 0;">';
           dayEvents.forEach(event => {
             const icon = event.type === 'maintenance' ? 'ðŸ”§' : 
                         event.type === 'cut' ? 'â›”' : 'ðŸ‘€';
             eventsHTML += `<li style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
               <strong>${icon} ${event.title}</strong>
               <br><small>Tipo: ${event.type}</small>
             </li>`;
           });
           eventsHTML += '</ul>';
           dayModalBody.innerHTML = eventsHTML;
         }
         
         dayModal.classList.add('show');
       }

       // Cerrar modal de eventos del dÃ­a
       document.getElementById('dayModalClose').addEventListener('click', () => {
         document.getElementById('dayModal').classList.remove('show');
       });

       // Cerrar modal al hacer clic en el overlay
       document.querySelector('.modal-overlay').addEventListener('click', () => {
         document.getElementById('dayModal').classList.remove('show');
       });

       // Funcionalidad del menÃº mÃ³vil
      initMobileMenu();

      function initMobileMenu() {
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        if (mobileMenuBtn && sidebar && sidebarOverlay) {
          // Abrir menÃº mÃ³vil
          mobileMenuBtn.addEventListener('click', function() {
            sidebar.classList.add('active');
            sidebarOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
          });

          // Cerrar menÃº mÃ³vil al hacer clic en el overlay
          sidebarOverlay.addEventListener('click', function() {
            sidebar.classList.remove('active');
            sidebarOverlay.classList.remove('active');
            document.body.style.overflow = '';
          });

          // Cerrar menÃº mÃ³vil al hacer clic en un enlace
          const navLinks = sidebar.querySelectorAll('.nav-link');
          navLinks.forEach(link => {
            link.addEventListener('click', function() {
              sidebar.classList.remove('active');
              sidebarOverlay.classList.remove('active');
              document.body.style.overflow = '';
            });
          });

          // Cerrar menÃº mÃ³vil con tecla Escape
          document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && sidebar.classList.contains('active')) {
              sidebar.classList.remove('active');
              sidebarOverlay.classList.remove('active');
              document.body.style.overflow = '';
            }
          });
        }
             }
     </script>

     <style>
       /* Estilos del calendario */
       #calendarGrid {
         position: relative;
         z-index: 1;
       }
       
       .calendar-day {
         padding: 15px 10px;
         text-align: center;
         border: 1px solid #e5e7eb;
         border-radius: 8px;
         cursor: pointer;
         transition: all 0.2s ease;
         background: white;
         min-height: 60px;
         display: flex;
         align-items: center;
         justify-content: center;
         font-weight: 500;
         position: relative;
         z-index: 1;
       }

       .calendar-day:hover {
         background: #f3f4f6;
         border-color: #d1d5db;
         transform: translateY(-2px);
         box-shadow: 0 4px 8px rgba(0,0,0,0.1);
       }

       .calendar-day.empty {
         background: #f9fafb;
         border-color: #e5e7eb;
         cursor: default;
       }

       .calendar-day.empty:hover {
         background: #f9fafb;
         transform: none;
         box-shadow: none;
       }

       /* Estilos para dÃ­as con eventos */
       .calendar-day.maintenance {
         background: #fef3c7;
         border-color: #f59e0b;
         color: #92400e;
       }

       .calendar-day.cut {
         background: #fee2e2;
         border-color: #ef4444;
         color: #991b1b;
       }

       .calendar-day.supervision {
         background: #dbeafe;
         border-color: #3b82f6;
         color: #1e40af;
       }

       /* Estilos para el header del calendario */
       .calendar-header {
         background: white;
         padding: 20px;
         border-radius: 12px;
         box-shadow: 0 1px 3px rgba(0,0,0,0.1);
         margin-bottom: 20px;
       }

       .calendar-header h2 {
         margin: 0;
         color: #374151;
         font-size: 1.5rem;
       }

       /* Estilos para los botones del calendario */
       .btn-sm {
         padding: 8px 16px;
         font-size: 0.875rem;
         border-radius: 6px;
         border: none;
         cursor: pointer;
         transition: all 0.2s ease;
       }

       .btn-secondary.btn-sm {
         background: #6b7280;
         color: white;
       }

       .btn-secondary.btn-sm:hover {
         background: #4b5563;
       }

       .btn-primary.btn-sm {
         background: #3b82f6;
         color: white;
       }

       .btn-primary.btn-sm:hover {
         background: #2563eb;
       }

       /* Asegurar que el header tenga prioridad sobre el calendario */
       .header {
         position: fixed;
         z-index: 1000;
       }

       .mobile-menu-btn {
         position: relative;
         z-index: 1001;
       }

       /* Asegurar que el main-content no interfiera */
       .main-content {
         position: relative;
         z-index: 1;
         margin-top: 70px;
       }

       /* Asegurar que el calendario estÃ© por debajo del header */
       .calendar-header {
         position: relative;
         z-index: 1;
       }

       /* Asegurar que el grid del calendario no interfiera con el header */
       #calendarGrid {
         position: relative;
         z-index: 1;
         margin-top: 20px;
       }

       /* Asegurar que los dÃ­as del calendario no se superpongan */
       .calendar-day {
         position: relative;
         z-index: 1;
       }

       /* Asegurar que el header tenga la mÃ¡xima prioridad */
       .header,
       .header * {
         position: relative;
         z-index: 1000 !important;
       }

       .mobile-menu-btn {
         z-index: 1001 !important;
       }

       /* Asegurar que el body tenga el z-index correcto */
       body {
         position: relative;
       }

       /* Asegurar que el contenido principal estÃ© por debajo del header */
       .main-content {
         position: relative;
         z-index: 1;
       }
         </style>
    <script src="../usuarios/common.js"></script>
    <script src="../usuarios/dashboard/dashboard.js"></script>
  </body>
</html>