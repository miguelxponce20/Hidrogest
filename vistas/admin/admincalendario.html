<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendario - Admin Hidrogest</title>
     <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../favicon/favicon-16x16.png"
    />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="../dashboard.css" />
    <link rel="stylesheet" href="admin.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="logo">
          <img src="../LOGO.png" alt="Logo" />
          <span class="logo-text">AdminPanel</span>
        </div>
      </div>
      <div class="header-center">
        <h2>GestiÃ³n de Calendario</h2>
      </div>
      <div class="header-right">
        <div class="user-menu">
          <button class="user-btn">
            <div class="user-avatar">A</div>
            <div class="user-info">
              <span class="user-name">Admin</span>
              <span class="user-type">Superuser</span>
            </div>
          </button>
        </div>
      </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <div class="nav-section">
          <h4 class="nav-title">Principal</h4>
          <ul class="nav-list">
            <li class="nav-item"><a class="nav-link" href="admin.html">ðŸ“Š Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="usuarios.html">ðŸ‘¥ Usuarios</a></li>
            <li class="nav-item"><a class="nav-link" href="reportes.html">ðŸ“¦ Reportes</a></li>
            <li class="nav-item"><a class="nav-link" href="facturacion.html">ðŸ’³ FacturaciÃ³n</a></li>
            <li class="nav-item active"><a class="nav-link" href="#">ðŸ“… Calendario</a></li>
          </ul>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="calendar-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <button id="prevMonth" class="btn-secondary btn-sm">â—€</button>
        <h2 id="currentMonth"></h2>
        <button id="nextMonth" class="btn-secondary btn-sm">â–¶</button>
        <button id="btnAddEvent" class="btn-primary btn-sm">âž• Nueva Incidencia</button>
      </div>

      <div id="calendarGrid" style="display:grid; grid-template-columns:repeat(7,1fr); gap:6px;"></div>
    </main>

    <!-- Modal: Eventos del DÃ­a -->
    <div id="dayModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="dayModalTitle"></h3>
          <button id="dayModalClose" class="modal-close">âœ–</button>
        </div>
        <div id="dayModalBody" class="modal-body"></div>
      </div>
      <div class="modal-overlay"></div>
    </div>

    <!-- Modal: Nueva Incidencia -->
    <div id="modal-evento" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Agregar Incidencia</h3>
          <button class="modal-close" data-close="modal-evento">âœ–</button>
        </div>
        <div class="modal-body">
          <form id="formEvento">
            <div class="form-group">
              <label for="fechaEvento">Fecha</label>
              <input type="date" id="fechaEvento" required />
            </div>
            <div class="form-group">
              <label for="tipoEvento">Tipo</label>
              <select id="tipoEvento" required>
                <option value="maintenance">ðŸ”§ Mantenimiento</option>
                <option value="cut">â›” Corte</option>
                <option value="supervision">ðŸ‘€ SupervisiÃ³n</option>
              </select>
            </div>
            <div class="form-group">
              <label for="tituloEvento">TÃ­tulo</label>
              <input type="text" id="tituloEvento" placeholder="Ej: Corte sector norte" required />
            </div>
            <div class="form-actions">
              <button type="submit" class="btn-primary">Guardar</button>
              <button type="button" class="btn-secondary" data-close="modal-evento">Cancelar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      const events = {
        "2025-09-05": [{ type: "maintenance", title: "Mantenimiento estaciÃ³n norte" }],
        "2025-09-10": [{ type: "cut", title: "Corte sector centro" }],
        "2025-09-15": [{ type: "supervision", title: "SupervisiÃ³n general" }],
      };

      const calendarGrid = document.getElementById("calendarGrid");
      const currentMonthEl = document.getElementById("currentMonth");
      let currentDate = new Date();

      function getMondayBasedDay(jsDay) {
        return (jsDay + 6) % 7;
      }

      function renderCalendar() {
        calendarGrid.innerHTML = "";
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        currentMonthEl.textContent = currentDate.toLocaleDateString("es-ES", {
          month: "long",
          year: "numeric",
        });

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startDay = getMondayBasedDay(firstDay.getDay());
        const daysInMonth = lastDay.getDate();

        for (let i = 0; i < startDay; i++) {
          const el = document.createElement("div");
          el.classList.add("calendar-day", "empty");
          calendarGrid.appendChild(el);
        }

        for (let d = 1; d <= daysInMonth; d++) {
          const dateStr = `${year}-${String(month + 1).padStart(2, "0")}-${String(d).padStart(2, "0")}`;
          const el = document.createElement("div");
          el.classList.add("calendar-day");
          el.textContent = d;

          if (events[dateStr]) {
            events[dateStr].forEach((e) => el.classList.add(e.type));
            el.onclick = () => showDayEvents(dateStr);
          }

          calendarGrid.appendChild(el);
        }
      }

    

      document.getElementById("prevMonth").onclick = () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
      };
      document.getElementById("nextMonth").onclick = () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
      };

      function capitalize(s) {
        return s.charAt(0).toUpperCase() + s.slice(1);
      }

      const modalEvento = document.getElementById("modal-evento");
      document.getElementById("btnAddEvent").onclick = () => {
        modalEvento.classList.add("show");
      };

      document.querySelectorAll("[data-close]").forEach((btn) => {
        btn.addEventListener("click", () => {
          document.getElementById(btn.getAttribute("data-close")).classList.remove("show");
        });
      });

      document.getElementById("formEvento").addEventListener("submit", (e) => {
        e.preventDefault();
        const fecha = document.getElementById("fechaEvento").value;
        const tipo = document.getElementById("tipoEvento").value;
        const titulo = document.getElementById("tituloEvento").value;

        if (!events[fecha]) events[fecha] = [];
        events[fecha].push({ type: tipo, title: titulo });

        modalEvento.classList.remove("show");
        e.target.reset();
        renderCalendar();
      });

      renderCalendar();
    </script>
  </body>
</html>